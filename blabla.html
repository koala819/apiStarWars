<!DOCTYPE html>
<html lang="fr">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>API StarWars</title>
<script>
    class StarWarsWidgetElement extends HTMLElement {
        constructor() {
            super();
            this._characters = [];
            this._pictures = [];

            const tmpl = document.getElementById("starwars-widget");
            const clone = tmpl.content.cloneNode(true);
            this.attachShadow({ mode: 'open' }).appendChild(clone);
        }

        fetchAPIData() {
            return fetch(`https://miadil.github.io/starwars-api/api/all.json`)
                .then(res => res.json())
                .then(res => {
                    console.log(res);
                    for (const { name, image } of res) {
                        this._characters.push(name);
                        this._pictures.push(image);
                    }
                    this.render()
                })
        }

        connectedCallback() {
            this.fetchAPIData().catch(console.error);
        }

        render() {
            const pictureFragment = document.createDocumentFragment();
            const charactersFragment = document.createDocumentFragment();

            for (let i = 0; i < this._pictures.length; i++) {
                const img = new Image(200, 200);
                img.src = this._pictures[i];
                pictureFragment.appendChild(img);
                charactersFragment.appendChild(document.createTextNode(this._characters[i]));
                charactersFragment.appendChild(document.createElement("br"));
            }

            this.shadowRoot.getElementById("pictureCharactere").appendChild(pictureFragment)
            this.shadowRoot.getElementById("charactere").appendChild(charactersFragment);
        }

    }

    document.addEventListener("DOMContentLoaded", () => {
        window.customElements.define('starwars-widget', StarWarsWidgetElement)
    });
</script>

<starwars-widget></starwars-widget>

<template id="starwars-widget">
    <style>
        img {
            width: 20%
        }
    </style>
    <div class="starwars-widget">
        <p>
            <div id="pictureCharactere"></div>
            <span id="charactere"></span>
        </p>
    </div>
</template>